<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game - Cross Device Controller</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="snake-favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="snake-favicon.png">
    <link rel="apple-touch-icon" href="snake-logo.png">
    <meta name="theme-color" content="#21808d">
    
    <!-- Firebase CDN - v8 Compatibility Mode for Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Different QR Code Libraries - Try multiple sources -->
    <script src="https://unpkg.com/qrious@4.0.2/dist/qrious.min.js"></script>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    
    <!-- Font Awesome for social icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Override CSS Media Queries -->
    <style>
        /* Force desktop and mobile views to be visible when JavaScript sets them */
        .desktop-view[style*="display: block"] {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .mobile-view[style*="display: block"] {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* Ensure hidden views stay hidden */
        .desktop-view[style*="display: none"],
        .mobile-view[style*="display: none"] {
            display: none !important;
        }

        /* Loading screen controls */
        .loading-screen {
            visibility: visible !important;
        }

        .loading-screen[style*="display: none"] {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-container">
            <div class="logo-container">
                <img src="snake-logo.png" alt="Snake Game Logo" class="loading-logo">
            </div>
            <div class="loading-spinner-container">
                <div class="loading-spinner"></div>
                <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <p class="loading-text">Loading Snake Game...</p>
        </div>
    </div>

    <!-- Desktop Game View -->
    <div id="desktop-view" class="desktop-view">
        <div class="desktop-container">
            <!-- Top Header -->
            <div class="top-header">
                <div class="title-section">
                    <div class="title-with-logo">
                        <img src="snake-logo.png" alt="Snake Game Logo" class="game-logo">
                        <div class="title-text">
                            <h1 class="game-title">Snake Game</h1>
                            <p class="creator-text">by Aryaman Godara</p>
                        </div>
                    </div>
                </div>
                <div class="social-section">
                    <a href="https://www.linkedin.com/in/aryamangodara/" target="_blank" class="social-link linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.instagram.com/aryaman_godara/" target="_blank" class="social-link instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>

            <!-- Main Game Area -->
            <div class="game-area">
                <div class="game-board-container">
                    <canvas id="game-canvas" width="600" height="600"></canvas>
                    <div id="game-over" class="game-over hidden">
                        <div class="game-over-content">
                            <h2>Game Over!</h2>
                            <div class="score-display">
                                <span class="score-label">Final Score:</span>
                                <span id="final-score" class="score-value">0</span>
                            </div>
                            <p class="restart-prompt">Use your phone controller to play again</p>
                        </div>
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="score-card">
                        <div class="current-score">
                            <span class="score-label">Score</span>
                            <span id="score" class="score-value">0</span>
                        </div>
                    </div>

                    <div class="connection-card">
                        <div class="session-code">
                            <span class="code-label">Session Code:</span>
                            <span id="session-code" class="code-value">123456</span>
                        </div>
                        <div class="qr-container">
                            <div id="qr-code-container">
                                <canvas id="qr-canvas" width="150" height="150"></canvas>
                            </div>
                            <div id="qr-loading" class="qr-loading">
                                <div class="loading-spinner"></div>
                                <p>Generating QR Code...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Controller View -->
    <div id="mobile-view" class="mobile-view">
        <!-- Connection Form -->
        <div id="connection-form" class="connection-form">
            <div class="mobile-header">
                <div class="mobile-logo-container">
                    <img src="snake-logo.png" alt="Snake Game Logo" class="mobile-logo">
                    <h1 class="mobile-title">Snake Controller</h1>
                </div>
            </div>
            
            <div class="connection-card">
                <div class="input-group">
                    <label for="session-input">Enter 6-digit session code:</label>
                    <input type="text" id="session-input" maxlength="6" placeholder="123456" pattern="[0-9]{6}">
                </div>
                
                <button id="connect-btn" class="btn btn-connect">Connect to Game</button>
                <div id="mobile-connection-status" class="connection-status"></div>
            </div>
        </div>
        
        <!-- Controller Interface - Joystick Style -->
        <div id="controller-interface" class="controller-interface">
            <div class="joystick-container">
                <!-- Joystick Control -->
                <div class="joystick-area">
                    <div id="joystick-base" class="joystick-base">
                        <div id="joystick-handle" class="joystick-handle"></div>
                    </div>
                </div>
                
                <!-- Center Control Button -->
                <div class="center-control">
                    <button id="btn-center" class="control-btn center-btn" disabled>
                        <span class="center-icon">‚ñ∂</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    
    <!-- Simple Loading Screen Handler with CSS Override Fix -->
    <script>
        window.addEventListener('load', function() {
            setTimeout(function() {
                console.log('üé¨ Starting loading screen sequence...');
                
                setTimeout(function() {
                    const loadingScreen = document.getElementById('loading-screen');
                    const desktopView = document.getElementById('desktop-view');
                    const mobileView = document.getElementById('mobile-view');
                    
                    console.log('‚è∞ Hiding loading screen...');
                    
                    // Hide loading screen with !important
                    loadingScreen.style.cssText = 'display: none !important';
                    
                    setTimeout(function() {
                        console.log('‚úÖ Loading screen hidden');
                        
                        // Show appropriate view with !important to override media queries
                        if (window.innerWidth <= 768) {
                            console.log('üì± Showing mobile view');
                            mobileView.style.cssText = 'display: block !important';
                            desktopView.style.cssText = 'display: none !important';
                        } else {
                            console.log('üñ•Ô∏è Showing desktop view');
                            desktopView.style.cssText = 'display: block !important';
                            mobileView.style.cssText = 'display: none !important';
                        }
                    }, 500);
                }, 2000);
            }, 100);
        });
    </script>
</body>
</html>